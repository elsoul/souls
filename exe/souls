#!/usr/bin/env ruby
require "souls"

def download_souls_service
  version = "v0.0.1"
  app_name = ARGV[1]
  system "curl -O https://storage.googleapis.com/souls/service/souls_service_#{version}.tar.gz"
  system "tar -zxvf souls_service_#{version}.tar.gz"
  system "mkdir #{app_name}"
  system "cp -r souls_service_#{version}/* #{app_name}/"
  system "rm -rf souls_service_#{version}.tar.gz && rm -rf souls_service_#{version}"
  puts "Welcome to Souls gRPC Service!"
  puts "Go to `./#{app_name}` and"
  puts "`souls s` !"
end

def download_souls_api
  version = "v0.0.2"
  app_name = ARGV[1]
  system "curl -O https://storage.googleapis.com/souls/api/souls_api_#{version}.tar.gz"
  system "tar -zxvf souls_api_#{version}.tar.gz"
  system "mkdir #{app_name}"
  system "cp -r souls_api_#{version}/* #{app_name}/"
  system "rm -rf souls_api_#{version}.tar.gz && rm -rf souls_api_#{version}"
  puts "Welcome to Souls GraphQL API!"
  puts "Go to `./#{app_name}` and"
  puts "`rails grpc:test` !"
end

begin
  case ARGV[0]
  when "new"
    if ARGV[1].nil?
      puts "you need to specify your app name \n `souls new app_name`"
      exit
    end
    puts "Which framework:   \n 1. SOULS gRPC Service \n 2. SOULS GraphQL API \n 3. SOULS NEXT JS Client \n Enter Number: "
    fw = STDIN.gets.chomp.to_i
    case fw
    when 1
      download_souls_service
    when 2
      download_souls_api
    else
      puts "Coming Soon ..."
    end
  when "s" || "server"
    system "bundle exec rake run_server"
  when "c" || "console"
    system "bundle exec irb"
  else
    puts "Welcome to Souls!Yeah!"
  end
rescue StandardError => error
  puts error
  puts "Thank you!Souls!"
end